("undefined"===typeof $||!$)&&alert('You must include JQuery to run WizzyWig. Consider adding this to the top of your HTML:\n<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"><\/script>');$(document).ready(function(){new CssLoader(cssUrl());var a=new Blesser;new WizzyWig(WizzyWig.editableElements,new Saver,new TableEditor(a),new DragonController(a),a)});
function cssUrl(){return $('script[src*="izzy"]').first().attr("src").replace(/\/javascript\/.*/g,"/css/wizzywig.css")};function Blesser(){var a=[];this.delegate=function(b){a.push(b)};this.bless=function(b){$.each(a,function(a,c){c(b)});return b}};function CssLoader(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);document.getElementsByTagName("head")[0].appendChild(b)};function original(a){return a.originalEvent}function DragSource(a,b){b||(b={});a.attr("draggable","true");a.bind("dragstart",function(d){a.addClass("drag");b.dragStart&&b.dragStart(a,b.effect?b.effect:"move");original(d).dataTransfer.setData("text/html","monkeys")});a.bind("dragend",function(){a.removeClass("drag");b.dragEnd&&b.dragEnd(a)})}
function DropTarget(a,b){function d(c){a.addClass("dropTarget");b.dragOver&&b.dragOver(a);original(c).preventDefault();return!1}b||(b={});a.bind("dragenter",d);a.bind("dragover",d);a.bind("dragleave",function(){a.removeClass("dropTarget");b.dragLeave&&b.dragLeave(a)});a.bind("drop",function(c){b.drop&&b.drop(a);a.removeClass("dropTarget");original(c).stopPropagation();return!1})};function DragonController(a){function b(a,b){a.each(function(){new DragSource($(this),{dragStart:d,effect:b})})}function d(a,b){g=a;i=b}function c(b){var e=g;"copy"===i&&(e=g.clone(),e.addClass("clear").removeClass("left"),a.bless(e),new DragSource(e,{dragStart:d}),new DropTarget(e,{drop:c}));b.before(e)}var e=this,g,i;this.makeMoveable=function(a){b(a,"move")};this.makeCopyable=function(a){b(a,"copy")};this.makeDropTarget=function(a){a.each(function(){new DropTarget($(this),{drop:c})})};a.delegate(function(a){e.makeMoveable(a);
e.makeDropTarget(a)})};function Inputter(a){var b=a.text(),d=new StyleCopier(a,["height","width"]);a.text("");a.append(Inputter.inputElement);var c=a.find("input");c.val(b);d.apply(c);c.blur(function(){var a=c.parent(),b=c.val();c.remove();a.html(b)});asPlain(c).focus()}Inputter.inputElement='<input class="inputter" name="inputter" type="text" draggable="false" value="@original text@">';function Saver(){function a(){$("body").append('<div id="saverSandbox" class="hidden">'+$("body").html()+"</div>");$("#saverSandbox .editable").each(function(){$(this).removeClass("editable")});$("#wizzywigConsole").remove();$("#wizzywigConsole").remove();var a=$("#saverSandbox").html().replace(/ class=\"\"/g,"");$("#saverSandbox").remove();return a}var b=this;this.contents=function(){var b=a();return"<html><head>"+$("head").html()+"</head><body>"+b+"</body></html>"};this.save=function(a){var c="data:application/octet-stream,"+
encodeURIComponent(b.contents());window.open(c,"Save");a.stopPropagation();a.preventDefault();return!1}};function StyleCopier(a,b){var d=$.map(b,function(b){return{styleName:b,styleValue:a.css(b)}});this.apply=function(a){$.each(d,function(b,d){a.css(d.styleName,d.styleValue)})}};function TableEditor(a){function b(){k?k=!1:$("#wizzywigTableEditor").hide()}function d(a,b){var c=middle(a),d=$("#wizzywigTableEditor").outerHeight();$("#wizzywigTableEditor").css("top",c-d/2);$("#wizzywigTableEditor").css("left",right(b)+10)}function c(){k=!0}function e(a){return function(){a();k=!1}}function g(){h.remove()}function i(){var b=h.clone();h.after(b);a.bless(b)}function o(){var b=j.parent(),c=b.clone();b.after(c);a.bless(c)}function p(){j.parent().remove();exists(h.find("td"))||h.remove()}
function q(){l(function(b){var c=b.clone();b.after(c);a.bless(c)});d(j,h)}function r(){l(function(a){a.remove()})}function l(a){var b=j.parent().children().index(j);h.find("tr").filter(function(){return!$(this).hasClass("fixture")}).each(function(){a($($(this).children("td").get(b)))})}function f(a,b,c){return'<div class="holder clear right">\n<table class="'+a+" "+b+'">\n'+m(c)+"</table>\n</div>\n"}function m(a){return 0==a.length?"":"<tr>"+n(a.head())+"</tr>"+m(a.tail())}function n(a){return""==
a?"":("1"==a.head()?'<td class="change"></td>':"<td></td>")+n(a.tail())}var j,h,k=!1;this.edit=function(a){var f=a.parents("table").first();exists(f)&&(exists($("#wizzywigTableEditor"))||($("body").append(TableEditor.console),$("#wizzywigTableEditor").hide(),$("#wizzywigTableEditor .add.table").click(e(i)),$("#wizzywigTableEditor .add.column").click(e(q)),$("#wizzywigTableEditor .add.row").click(e(o)),$("#wizzywigTableEditor .delete.table").click(e(g)),$("#wizzywigTableEditor .delete.column").click(e(r)),
$("#wizzywigTableEditor .delete.row").click(e(p)),$("#wizzywigTableEditor").find(".add, .delete").mouseenter(c),$("#wizzywigTableEditor").mouseleave(b)),j=a,h=f,$("#wizzywigTableEditor").show(),d(a,f));a=a.find("input.inputter").first();exists(a)&&a.blur(b)};TableEditor.affectColumn=["01000","01000","01000","01000"];TableEditor.affectRow=["00000","11111","00000","00000"];TableEditor.affectAll=["11111","11111","11111","11111"];TableEditor.copyTableButton=f("add","table",TableEditor.affectAll);TableEditor.addRowButton=
f("add","row",TableEditor.affectRow);TableEditor.addColumnButton=f("add","column",TableEditor.affectColumn);TableEditor.deleteTableButton=f("delete","table",TableEditor.affectAll);TableEditor.deleteRowButton=f("delete","row",TableEditor.affectRow);TableEditor.deleteColumnButton=f("delete","column",TableEditor.affectColumn);TableEditor.add='<div class="spaced left"><div class="iconsTitle clear right">+</div>'+TableEditor.copyTableButton+TableEditor.addRowButton+TableEditor.addColumnButton+"</div>";
TableEditor.deleteCells='<div class="spaced left"><div class="iconsTitle clear left">-</div>'+TableEditor.deleteTableButton+TableEditor.deleteRowButton+TableEditor.deleteColumnButton+"</div>";TableEditor.console='<div id="wizzywigTableEditor" class="console">'+TableEditor.add+TableEditor.deleteCells+"</div>"};function asPlain(a){return a[0]}function exists(a){if("undefined"===typeof a)return!1;if(!a.size)throw"Not a JQuery object";return 0<a.size()}var tail=function(){return this.slice(1)};String.prototype.head=function(){return this.slice(0,1)};String.prototype.tail=tail;Array.prototype.head=function(){return this[0]};Array.prototype.tail=tail;function whole(a){return parseInt(a.toFixed(0))}function middle(a){return a.offset().top+whole(a.outerHeight()/2)}function left(a){return a.offset().left}
function right(a){return a.offset().left+a.outerWidth()}
function WizzyWig(a,b,d,c,e){function g(b){b.is("td")?i(b):b.find($(a)).each(function(){i($(this))})}function i(a){a.addClass("editable");a.click(function(){exists(a.find("input.inputter"))||new Inputter(a);d.edit(a)});return a}e.delegate(g);g($("body"));c.makeMoveable($(WizzyWig.draggableElements));c.makeDropTarget($(WizzyWig.draggableElements));$("body").append(WizzyWig.console);$("#wizzywigConsole .save").click(function(a){b.save(a)});c.makeCopyable($("#wizzywigConsole table"))}
WizzyWig.editableElements="td, h1, h2, p";WizzyWig.draggableElements="table, h1, h2, p";WizzyWig.clearDiv='<div class="clear"/>';WizzyWig.saveButton='<button class="save clear left">Save</button>';WizzyWig.helpButton='<button class="help clear left">Help</button>';WizzyWig.simpleConcept1='<table id="simpleConcept"><tr><td class="names">Simple Concept 1</td><td>some input 1</td><td class="names">some action</td><td>some input 2</td></tr></table>';WizzyWig.simpleConcept2='<table id="simpleConcept"><tr><td class="names">Simple Concept 2</td><td>some input</td></tr></table>';
WizzyWig.multiRowConcept='<table class="left"><tr><td class="fixture">MultiRow Concept</td></tr><tr class="names"><td>heading 1</td><td>heading 2</td></tr><tr><td>data element 1</td><td>data element 2</td></tr></table>';
WizzyWig.console='<div class="middleFixed"><div id="wizzywigConsole" class="console"><span id="plus">w</span><div class="left spaced" style="margin-top: 20px; ">'+WizzyWig.saveButton+WizzyWig.helpButton+'</div><div class="left">'+WizzyWig.simpleConcept1+WizzyWig.simpleConcept2+"</div>"+WizzyWig.multiRowConcept+WizzyWig.clearDiv+"</div></div>";WizzyWig.knownBugs="These features are known to misbehave in certain browsers:\n * Input fields don't respond to mouse clicks (Firefox)\n * Failure to insert the correct cells when adding columns (IE8)\n";
