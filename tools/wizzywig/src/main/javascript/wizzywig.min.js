("undefined"===typeof $||!$)&&alert('You must include JQuery to run WizzyWig. Consider adding this to the top of your HTML:\n<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"><\/script>');$(document).ready(function(){new CssLoader(cssUrl());new WizzyWig(WizzyWig.editableElements,new Saver,new TableEditor,new DragonController)});function cssUrl(){return $('script[src*="izzy"]').first().attr("src").replace(/\/javascript\/.*/g,"/css/wizzywig.css")};function CssLoader(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);document.getElementsByTagName("head")[0].appendChild(b)};function original(a){return a.originalEvent}function DragSource(a,b){b||(b={});a.attr("draggable","true");a.bind("dragstart",function(d){a.addClass("drag");b.dragStart&&b.dragStart(a,b.effect?b.effect:"move");original(d).dataTransfer.setData("text/html","monkeys")});a.bind("dragend",function(){a.removeClass("drag");b.dragEnd&&b.dragEnd(a)})}
function DropTarget(a,b){function d(c){a.addClass("dropTarget");b.dragOver&&b.dragOver(a);original(c).preventDefault();return!1}b||(b={});a.bind("dragenter",d);a.bind("dragover",d);a.bind("dragleave",function(){a.removeClass("dropTarget");b.dragLeave&&b.dragLeave(a)});a.bind("drop",function(c){b.drop&&b.drop(a);a.removeClass("dropTarget");original(c).stopPropagation();return!1})};function DragonController(){function a(a,c){a.each(function(){new DragSource($(this),{dragStart:b,effect:c})})}function b(a,b){c=a;f=b}function d(a){var e=c;"copy"===f&&(e=c.clone(),e.addClass("clear").removeClass("left"),e.find(WizzyWig.editableElements).each(function(){j($(this))}),new DragSource(e,{dragStart:b}),new DropTarget(e,{drop:d}));a.before(e)}var c,f,j;this.makeMoveable=function(b){a(b,"move")};this.makeCopyable=function(b){a(b,"copy")};this.makeDropTarget=function(a,b){j=b;a.each(function(){new DropTarget($(this),
{drop:d})})}};function Inputter(a){var b=a.text(),d=new StyleCopier(a,["height","width"]);a.text("");a.append(Inputter.inputElement);var c=a.find("input");c.val(b);d.apply(c);c.blur(function(){var a=c.parent(),b=c.val();c.remove();a.html(b)});asPlain(c).focus()}Inputter.inputElement='<input class="inputter" name="inputter" type="text" draggable="false" value="@original text@">';function Saver(){function a(){$("body").append('<div id="saverSandbox" class="hidden">'+$("body").html()+"</div>");$("#saverSandbox .editable").each(function(){$(this).removeClass("editable")});$("#wizzywigConsole").remove();$("#wizzywigConsole").remove();var a=$("#saverSandbox").html().replace(/ class=\"\"/g,"");$("#saverSandbox").remove();return a}var b=this;this.contents=function(){var b=a();return"<html><head>"+$("head").html()+"</head><body>"+b+"</body></html>"};this.save=function(a){var c="data:application/octet-stream,"+
encodeURIComponent(b.contents());window.open(c,"Save");a.stopPropagation();a.preventDefault();return!1}};function StyleCopier(a,b){var d=$.map(b,function(b){return{styleName:b,styleValue:a.css(b)}});this.apply=function(a){$.each(d,function(b,d){a.css(d.styleName,d.styleValue)})}};function TableEditor(){function a(a,b){var c=middle(a),d=$("#wizzywigTableEditor").outerHeight();$("#wizzywigTableEditor").css("top",c-d/2);$("#wizzywigTableEditor").css("left",right(b))}function b(){g.remove()}function d(){var a=g.clone();a.find("td").each(function(){h($(this))});g.after(a)}function c(){var a=i.parent(),b=a.clone();b.children().each(function(){h($(this))});a.after(b)}function f(){i.parent().remove();exists(g.find("td"))||g.remove()}function j(){e(function(a){a.after(h(a.clone()))});
a(i,g)}function k(){e(function(a){a.remove()})}function e(a){var b=i.parent().children().index(i);g.find("tr").filter(function(){return!$(this).hasClass("fixture")}).each(function(){a($($(this).children("td").get(b)))})}var i,g,h;this.edit=function(e){var h=e.parents("table").first();exists(h)&&(exists($("#wizzywigTableEditor"))||($("body").append(TableEditor.console),$("#wizzywigTableEditor").hide(),$("#wizzywigTableEditor .copyTable").click(d),$("#wizzywigTableEditor .addColumn").click(j),$("#wizzywigTableEditor .addRow").click(c),
$("#wizzywigTableEditor .deleteTable").click(b),$("#wizzywigTableEditor .deleteColumn").click(k),$("#wizzywigTableEditor .deleteRow").click(f)),i=e,g=h,a(e,h),$("#wizzywigTableEditor").show())};this.addBlesser=function(a){h=a}}TableEditor.buttonPad='<table>   <tr style="visibility: hidden">       <td></td>       <td style="visibility: visible;"><div class="arrow u"></div></td>       <td></td>   </tr>   <tr>       <td><div class="arrow l"></div></td>       <td title="Add cells" style="visibility: hidden"></td>       <td><div class="arrow r"></div></td>   </tr>   <tr style="visibility: hidden">       <td></td>       <td style="visibility: visible;"><div class="arrow d"></div></td>       <td></td>   </tr></table>';
WizzyWig.copyTableButton='<button class="copyTable clear right">Copy Table</button>';WizzyWig.addRowButton='<button class="addRow clear right">Add Row</button>';WizzyWig.addColumnButton='<button class="addColumn clear right">Add Column</button>';WizzyWig.deleteTableButton='<button class="deleteTable clear left">Delete Table</button>';WizzyWig.deleteRowButton='<button class="deleteRow clear left">Delete Row</button>';WizzyWig.deleteColumnButton='<button class="deleteColumn clear left">Delete Column</button>';
TableEditor.add='<div class="spaced left">'+WizzyWig.copyTableButton+WizzyWig.addRowButton+WizzyWig.addColumnButton+"</div>";TableEditor.deleteCells='<div class="spaced left">'+WizzyWig.deleteTableButton+WizzyWig.deleteRowButton+WizzyWig.deleteColumnButton+"</div>";TableEditor.circleConsole='<div id="add" class="console circle left">'+TableEditor.buttonPad+"</div>";TableEditor.console='<div id="wizzywigTableEditor">'+TableEditor.add+TableEditor.deleteCells+"</div>";function asPlain(a){return a[0]}function exists(a){if("undefined"===typeof a)return!1;if(!a.size)throw"Not a JQuery object";return 0<a.size()}function whole(a){return parseInt(a.toFixed(0))}function middle(a){return a.offset().top+whole(a.outerHeight()/2)}function left(a){return a.offset().left}function right(a){return a.offset().left+a.outerWidth()}
function WizzyWig(a,b,d,c){function f(a){a.addClass("editable");a.click(function(){d.edit(a);exists(a.find("input.inputter"))||new Inputter(a)});return a}$(a).each(function(){f($(this))});d.addBlesser(f);c.makeMoveable($(WizzyWig.draggableElements));c.makeDropTarget($(WizzyWig.draggableElements),f);$("body").append(WizzyWig.console);$("#wizzywigConsole .save").click(function(a){b.save(a)});c.makeCopyable($("#wizzywigConsole table"))}WizzyWig.editableElements="td, h1, h2, p";
WizzyWig.draggableElements="table, h1, h2, p";WizzyWig.clearDiv='<div class="clear"/>';WizzyWig.saveButton='<button class="save clear left">Save</button>';WizzyWig.helpButton='<button class="help clear left">Help</button>';WizzyWig.simpleConcept='<table id="simpleConcept" class="left"><tr><td class="names">Simple Concept</td><td>x</td><td class="names">does</td><td>y</td></tr></table>';WizzyWig.multiRowConcept='<table class="left"><tr><td class="fixture">MultiRow Concept</td></tr><tr class="names"><td>heading 1</td><td>heading 2</td></tr><tr><td>data 1</td><td>data 2</td></tr></table>';
WizzyWig.console='<div class="middleFixed"><div id="wizzywigConsole" class="console tablet"><span id="plus">w</span><div class="left spaced" style="margin-top: 20px; ">'+WizzyWig.saveButton+WizzyWig.helpButton+"</div>"+WizzyWig.simpleConcept+WizzyWig.multiRowConcept+WizzyWig.clearDiv+"</div></div>";WizzyWig.knownBugs="These features are known to misbehave in certain browsers:\n * Input fields don't respond to mouse clicks (Firefox)\n * Failure to insert the correct cells when adding columns (IE8)\n";
